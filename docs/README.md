content-extraction-tool - приложение для объединения определённой логики в плагины и JSON модели.

### Основные объекты

#### Object

*Класс: `Objects/Object.py`*
*Список: `Plugins/*`*

Может называться как плагин. Является BaseModel из Pydantic v.2.

Object представляет модель с любыми данными, например, подключение к базе данных, конфиг и т.д. Может быть вызван только из кода. При инициализации приложения собираются все Objects из папки src/Plugins.

#### Namespace

*Класс: `Objects/Namespace.py`*

Содержит поля: 

`consts` — константы, актуальные для этого класса
`locales` — строки локализации, актуальные для этого класса.

#### Section

*Класс: `Objects/Section.py`*

Позволяет выделить класс в "секцию" для логгирования сообщений.

*@property section_name* — массив, который будет подставлен
*@property prefix* — префикс сообщения
*log(), log_error(), log_success()* — собственно, алиас для app.Logger.log, в которых подставляется section_name.

#### Configurable

*Класс: `Objects/Configurable.py`*

Класс, который может содержать в себе настройки, актуальные для него.

#### Executable

*Класс: `Plugins/Executables/Types/Executable.py`*
*Список: `Plugins/*`*

Расширение Object. В отличии от него, имеют возможность быть вызванными из условного интерефейса.

Для вызова имеет следующие подклассы (наследуются от Objects.Outer):

##### arguments

Список аргументов (Argument), с которыми будет проведено сопоставление при вызове. 

*@property args* — `NameDictList` для текущего уровня
*@property recursive_args* — суммирование всех аргументов из родительских классов
*@property do_m_a_i* — workaround про включение аргументов не представленных для сравнения
*get()* — вопреки названию функции, возвращает `ArgumentDict`, который можно использовать при выполнении

##### env_variables

Содержит актуальные для класса env аргументы.

##### execute

Основная логика скрипта, что он возвращает, а что принимает задаётся в `arguments`.

*execute()* — функция исполнения. Вызывает `before()`, `implementation()` и `after()`. Не следует переназначать.
*implementation()* — функция скрипта. Должен возвращать `Plugins.Executables.Response.Response`

##### meta

Основное описание класса. Основные функции:

*@property name* — название модуля без "Plugins."
*@property class_name* — название модуля вместе с названием класса

##### saver

Предоставляет возможность создать ContentUnit'ы с автоматической записью в db и логированием о создании.

##### submodules

Позволяет задать субмодули для класса.

`items` — список классов
`external` — помеченные внешние модули

##### variables

Внешние переменные класса. Задаётся через items = ApplyArgumentList

Все эти подклассы могут быть переназначены при наследовании.

Вызывается Executable через переходник *Plugins.Executables.Call* из View.

#### Подвиды Executable

*self_name* определяет название подвида.

**Act**

Ничем не отличается от Executable. По назначению - исполнение любого действия, предоставлять api

**Extractor**

По назначению - вывод данных в модели ContentUnit

**Representation**

Объединение прошлых двух. В отличии от Executable, может задавать ContentUnit в своём формате.

Не имеет собственной логики. Для исполнения перебирает субмодули (конкретнее перебирает Extractors), сверяя аргументы, и при нахождении нужного использует его логику. TODO

**Service**

Executable, исполняющийся раз в определённое время. TODO

#### Plugins.App.Arguments.Argument.*

Позволяет создать экземпляр класса для сверки переданных аргументов. На вход берёт строку или любые другие данные и преобразует или бросает assertion при передаче оригинала. Зависит от того, какой Argument вы выбрали. StringArgument вернёт строку, BooleanArgument вернёт bool и т.д.

*name* — название, которое будет использовано для получения из передаваемых аргументов
*default* — значение по умолчанию, если параметр с названием `name` не передан
*input_value* — передаваемое значение
*implementation()* — функция, возвращающая результат из `self.input_value`.

Аргументы нужно передавать в объекте `Plugins.Data.NameDictList`.

##### Plugins.App.Arguments.ArgumentDict

Массив с Argument'ами, который можно использовать как словарь.

##### Comparer

Сравнение массива с Argument'ами и переданных значений в словаре.

*toDict()* — возвращает `Plugins.App.Arguments.ArgumentDict`.

##### Variable

На самом деле тот же Argument. Внешняя переменная, которая может быть видима с предполагаемого интерфейса, в ней например, можно хранить прогресс загрузки или список полученного. TODO

##### View

Для приложения должен быть написан View, имплементирующий основной запрос и вызов Executable. Для командной строки это Views/CLI.py. TODO

### Инициализация приложения

View инициализирует запуск приложения. 

Сначала идёт инициализация основных синглтонов:
1. Storage - набор директорий рядом с папкой src. Эта папка будет обозначаться как %storage%.
2. Config - сравнение переданных параметров из %storage%/settings/config.json с прописанными параметрам, конфиг. Env - переменные, заданные от env_variables.
3. Logger - обёртка над функцией print. Позволяет вывести сообщение, задав категорию, к которой оно относится, тип (ошибка, успех, простое сообщение), префикс для визуального отличия.
4. DbConnection - инициализирует основные базы данных (content, instance, temp)
5. PluginsList - собирает файлы плагинов из директории %app%/Plugins в массив. 
6. DownloadManager - скачивание файлов и их очередь

После инициализации идёт вызов Plugins/Executables/Call.py, который находит плагин по переданному названию в массиве от PluginsList, вызывает функцию Execute.execute() этого класса. TODO

### Execution queue

Позволяет задать очередь выполнения скриптов.

Передаётся в формате:

`return_from` - индекс класса, из которого будет возвращён результат

`variables` - дополнительные переменные

`items` - массив с очередью классов

Используемые в `replacement` знаки:

`$` - получение элемента из результатов выполнение очередей по индексу (например, $0)

`#` - получение переменной
